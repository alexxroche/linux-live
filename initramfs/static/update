#!/bin/bash

# How to rebuild these static binaries:
# - using buildroot scripts <buildroot.uclibc.org>
# - unpack buildroot in /usr/src
# - copy busybox config (generated by busybox bbconfig) to /usr/src/buildroot-source/package/busybox/busybox-1.20.x.config
# - cd /usr/src/buildroot-sources
# - make menuconfig
# - configure buildroot to compile static libraries, set target processor architecture, and so on
# - some manual tweaking is necessary so buildroot properly compiles ntfs-3g driver, sorry
# - make
# - find static binaries in /usr/src/buildroot-sources/output/target/bin/ etc
#
# - all sources can be found at http://ftp.slax.org/Slax-7.0-development/sources/Slax-7.0-sources

# Automatically determine the architecture we're building on:
if [ -z "$MYARCH" ]; then
  case "$( uname -m )" in
    i?86) export MYARCH=i486 ;;
    arm*) export MYARCH=arm ;;
    # Unless $MYARCH is already set, use uname -m for all other archs:
       *) export MYARCH=$( uname -m ) ;;
  esac
fi

# link, or fallback to copy if filesystem does not support it
touch link-test
ln -f link-test link-test2 2>/dev/null && LN=ln || LN=cp
rm -f link-test*

$LN -f busybox-$MYARCH ./busybox
$LN -f mount.ntfs-3g-$MYARCH ./mount.ntfs-3g
$LN -f mount.dynfilefs-$MYARCH ./mount.dynfilefs
$LN -f eject-$MYARCH ./eject
